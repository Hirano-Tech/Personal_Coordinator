## ğŸ’­ã€€â‘  ã“ã® Web ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒ„ã‚¯ã‚ã†ã¨è€ƒãˆãŸèƒŒæ™¯

<img src='https://camo.qiitausercontent.com/f3c03bbbbf963d18cfbf8248b121e3f85d2cf15a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3630333237392f35353730346361332d396366342d383466362d623138362d3539356433303232323733632e706e67' alt='ã€J-WAVEã€‘ GROOVE LINE' title='ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã®å½±éŸ¿é ˜åŸŸ' alt='ã€ç”»åƒã€‘ ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã®å½±éŸ¿é ˜åŸŸ' width='40%' />

  1. æ´‹æœã‚’è³¼å…¥ã™ã‚‹ãã£ã‹ã‘ãŒã€ã“ã‚Œã¾ã§ã¯ãƒ†ãƒ¬ãƒ“ï¼Œé›‘èªŒ ãªã©ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã«æ²è¼‰ã•ã‚ŒãŸã‚‚ã®ã‚’è¦‹ã¦ã€åº—èˆ—ã«ã”æ¥åº—ã•ã‚Œã‚‹ã“ã¨ãŒä¸»æµã§ã—ãŸã€‚
  2. ç¾åœ¨ã§ã¯ å®¹å§¿ã®æ•´ã£ãŸæœ‰åäººã§ã¯ãªãã€Instagramï¼ŒYouTube ãªã©ã®ä¸€èˆ¬äººã®ç€ã“ãªã—ã‚’è¦‹ã¦ã€åº—èˆ—ã«ã”æ¥åº—ã•ã‚Œã‚‹ãŠå®¢æ§˜ãŒã ã‚“ã ã‚“ã¨å¢—ãˆã¦ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
  3. ã“ã®æµã‚Œã‚’æ„Ÿã˜ã¨ã‚Šã€[GUï¼ˆã‚¸ãƒ¼ãƒ¦ãƒ¼ï¼‰](https://www.gu-global.com/jp/ja/styling/?gender=women) ã‚„ [UNITED ARROWS](https://store.united-arrows.co.jp/shop/ua/styling) ã¯ã€åº—èˆ—ã§åƒãè²©å£²å“¡ã®ç€ã“ãªã—ã‚’ SNS ã®ã‚ˆã†ã«å…¬é–‹ã™ã‚‹ã“ã¨ã§ãŠå®¢æ§˜ãŒã”è‡ªèº«ã®å¹´é½¢ãƒ»å®¹å§¿ã«è¿‘ã„äººã®ç€ã“ãªã—ã‚’å‚è€ƒã«ã—ã¦ã„ãŸã ã‘ã‚‹ã‚ˆã†ãªå–ã‚Šçµ„ã¿ã‚’ãŠã“ãªã£ã¦ã„ã¾ã™ã€‚
  4. ã“ã®å–ã‚Šçµ„ã¿ã«ã‚ˆã‚Šã€è²©å£²å“¡ã®ä¸­ã«ã¯ãŠå®¢æ§˜ã‹ã‚‰ç›´æ¥ æ¥å®¢ã—ã¦æ¬²ã—ã„ã¨ã„ã†å•ã„åˆã‚ã›ã‚’ã„ãŸã ããªã©ã€æ–°è¦é¡§å®¢ã®ç²å¾—ã«æˆåŠŸã—ã¦ã„ã¾ã™ã€‚
  5. ç§ã¯ã€ã“ã‚Œã‹ã‚‰å»ƒã‚Œã‚†ãã¨è¨€ã‚ã‚Œã¦ã„ã‚‹ 'è²©å£²å“¡' ã®æ–°ãŸãªæ´»èºã®å ´ã§ã‚ã‚‹ã¨æ„Ÿã˜ã€é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚

> ###### ğŸ”—ã€€å‚è€ƒè³‡æ–™
> > [â€œå£²ã‚Šã«ã¤ãªãŒã‚‹â€ ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢ã¨ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ã®å®Ÿæ…‹èª¿æŸ» | æ ªå¼ä¼šç¤¾ãƒˆãƒ©ã‚¤ãƒãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢ãƒã‚¦ã‚¹](https://www.tribalmedia.co.jp/news/13629)

---

## ğŸ–¥ã€€â‘¡ æŠ€è¡“ä»•æ§˜ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒï¼‰

- **Ruby** Version 3.0.1
- **Ruby on Rails** Version 6.1.3.2
- **MySQL** Version 8.0.25
- **Docker** Version 20.10.7

##### â” Qï¼†Aï¼šãªãœã€é–‹ç™ºç’°å¢ƒã« Docker ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ï¼Ÿ

  - Docker ã¯ã€Linux ç’°å¢ƒï¼ˆåŠã³ã€CUI ã‚³ãƒãƒ³ãƒ‰ï¼‰ã«æ…£ã‚Œã‚‹ãŸã‚ã§ã™ã€‚

## ğŸŒã€€â‘¢ æŠ€è¡“ä»•æ§˜ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰

- **Elastic Compute Cloud**
  - Regionï¼šã‚¢ã‚¸ã‚¢ãƒ»ãƒ‘ã‚·ãƒ•ã‚£ãƒƒã‚¯ï¼ˆå¤§é˜ªï¼‰
  - ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ï¼št2.microï¼ˆç„¡æ–™åˆ©ç”¨æ ï¼‰
  - URLï¼šhttp://13.208.151.178
    - ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‹ã‚‰ã®é–²è¦§ã‚’æ¨å¥¨ã—ã¾ã™ã€‚
    - äº‹å‰ã«ã€ã‚¸ãƒ¼ãƒ¦ãƒ¼ï¼ˆ[iOS](https://apps.apple.com/us/app/%E3%82%B8%E3%83%BC%E3%83%A6%E3%83%BC/id504542019)ï¼Œ[Android](https://play.google.com/store/apps/details?id=com.osharemaker)ï¼‰ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

- **Relational Database Service**
  - Regionï¼šç±³å›½è¥¿éƒ¨ï¼ˆã‚ªãƒ¬ã‚´ãƒ³ï¼‰
  - ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ï¼šdb.t2.microï¼ˆç„¡æ–™åˆ©ç”¨æ ï¼‰

- **Simple Storage Service**
- **Cloud Front**
- **Virtual Private Cloud**

##### â” Qï¼†Aï¼šãªãœã€åˆ¥ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«é…ç½®ã—ã¦ã„ã‚‹ã®ã§ã™ã‹ï¼Ÿ

  - åŸºæœ¬çš„ã«åˆ©ç”¨æ–™é‡‘ æœ€å®‰å€¤æ§‹æˆã«ã—ã¦ã„ã¾ã™ã€‚  
[åˆ¥ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ | GitHub](https://github.com/Hirano-Tech/Piston2438_DJ-MIX) ã«ã¦ã€EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å€‹äººåˆ©ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€RDS ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ç¾åœ¨ ç„¡æ–™åˆ©ç”¨æ ã§ã™ãŒã€è²»ç”¨é¢ã§æœ€å®‰å€¤ã¨ãªã‚‹å›½å¤–ã‚’æ¡æŠã—ã¦ã„ã¾ã™ã€‚

## âš™ï¸ã€€â‘£ Dockerfile å‚™å¿˜éŒ²

```Dockerfile
FROM ruby:3.0.1

RUN curl -fsSL https://deb.nodesource.com/setup_16.x | bash - \
    && apt-get update && apt-get install -y vim nodejs \
    && npm install --global yarn && gem install rails -v '6.1.3.2'

WORKDIR /var/www/'ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å'

ADD . /
RUN bundle install
```

> ###### ğŸ”—ã€€å‚è€ƒè³‡æ–™
> > â— [Docker ã‚’ Compose ã—ãªã„ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ã€‚| Zenn](https://zenn.dev/hirano_tech/articles/68dbdc185dfb61)

## ğŸ—„ã€€â‘¤ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### â— éƒ½é“åºœçœŒãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«

|     Field    |       Type        | Null | Key | Default |     Extra      |
|:------------:|:-----------------:|:----:|:---:|:-------:|:--------------:|
|      id      | TINYINT UNSIGNED  |  NO  | PRI |  NULL   | auto_increment |
|     name     |   VARCHAR(255)    |  NO  |     |  NULL   |                |

```SQL
$mysql> CREATE TABLE IF NOT EXISTS 'ãƒ†ãƒ¼ãƒ–ãƒ«å'(
  id TINYINT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(255) NOT NULL
) CHARACTER SET utf8mb4;
```

> ###### ğŸ”—ã€€å‚è€ƒè³‡æ–™
> > â— [éƒ½é“åºœçœŒãƒ‡ãƒ¼ã‚¿ Seeds ãƒ•ã‚¡ã‚¤ãƒ«](https://github.com/Hirano-Tech/Seeding-Vault/blob/master/Ruby_Prefecture.rb)

### â— ã‚¸ãƒ¼ãƒ¦ãƒ¼ å›½å†…åº—èˆ—ä¸€è¦§ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«

|     Field     |       Type        | Null | Key | Default |     Extra      |
|:-------------:|:-----------------:|:----:|:---:|:-------:|:--------------:|
|      id       | TINYINT UNSIGNED  |  NO  | PRI |  NULL   | auto_increment |
|     name      |   VARCHAR(255)    |  NO  |     |  NULL   |                |
| prefecture_id | TINYINT UNSIGNED  |  NO  | MUL |  NULL   |                |
|    address    |   VARCHAR(255)    |  NO  |     |  NULL   |                |
|     phone     |   VARCHAR(255)    |  NO  |     |  NULL   |                |

```SQL
$mysql> CREATE TABLE IF NOT EXISTS 'ãƒ†ãƒ¼ãƒ–ãƒ«å'(
  id SMALLINT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(255) NOT NULL,
  prefecture_id TINYINT UNSIGNED NOT NULL,
  address VARCHAR(255) NOT NULL,
  phone VARCHAR(255) NOT NULL,

  FOREIGN KEY (prefecture_id) REFERENCES prefectures(id)
) CHARACTER SET utf8mb4;
```

> ###### ğŸ”—ã€€å‚è€ƒè³‡æ–™
> > â— [ã‚¸ãƒ¼ãƒ¦ãƒ¼ å›½å†…åº—èˆ—ä¸€è¦§ãƒ‡ãƒ¼ã‚¿ Seeds ãƒ•ã‚¡ã‚¤ãƒ«](https://github.com/Hirano-Tech/Seeding-Vault/blob/master/Ruby_GU-Store.rb)

### â— ã‚¸ãƒ¼ãƒ¦ãƒ¼ ãŠã—ã‚ƒãƒªã‚¹ã‚¿ä¸€è¦§ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«

|  Field   |       Type        | Null | Key | Default |     Extra      |
|:--------:|:-----------------:|:----:|:---:|:-------:|:--------------:|
|    id    | SMALLINT UNSIGNED |  NO  | PRI |  NULL   | auto_increment |
|   name   |   VARCHAR(255)    |  NO  |     |  NULL   |                |
|  gender  | TINYINT UNSIGNED  |  NO  |     |    1    |                |
|  height  | TINYINT UNSIGNED  |  NO  |     |  NULL   |                |
| staff_id |   VARCHAR(255)    |  NO  | UNI |  NULL   |                |
| store_id | SMALLINT UNSIGNED |  NO  | MUL |  NULL   |                |
| official | TINYINT UNSIGNED  |  NO  |     |    0    |                |

- `staff_id` ã‚«ãƒ©ãƒ ã¯ã€å„ãŠã—ã‚ƒãƒªã‚¹ã‚¿ãƒšãƒ¼ã‚¸ã® URLï¼ˆ`https://www.gu-global.com/jp/ja/styling/staff/`ï¼‰ã«å‰²ã‚ŠæŒ¯ã‚‰ã‚Œã¦ã„ã‚‹å€¤ã‚’æ ¼ç´ã—ã¦ã„ã‚‹ãŸã‚ã€å¤–éƒ¨ã‚­ãƒ¼ã§ã¯ãªã **ä¸€æ„æ€§** ã§ã™ã€‚

```SQL
$mysql> CREATE TABLE IF NOT EXISTS 'ãƒ†ãƒ¼ãƒ–ãƒ«å'(
  id SMALLINT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(255) NOT NULL,
  gender TINYINT UNSIGNED NOT NULL DEFAULT TRUE,
  height TINYINT UNSIGNED NOT NULL,
  staff_id VARCHAR(255) NOT NULL UNIQUE,
  store_id SMALLINT UNSIGNED NOT NULL,
  official TINYINT UNSIGNED NOT NULL DEFAULT FALSE,

  FOREIGN KEY (store_id) REFERENCES gu_stores(id)
) CHARACTER SET utf8mb4;
```

> ###### ğŸ”—ã€€å‚è€ƒè³‡æ–™
> > â— [ãŠã—ã‚ƒãƒªã‚¹ã‚¿ä¸€è¦§ãƒ‡ãƒ¼ã‚¿ Seeds ãƒ•ã‚¡ã‚¤ãƒ«](https://github.com/Hirano-Tech/Seeding-Vault/blob/master/Ruby_GU-Osyalista.rb)

## ğŸ”ã€€â‘¥ ãŠã—ã‚ƒãƒªã‚¹ã‚¿æ¤œç´¢ å‡¦ç†ã®æµã‚Œ

```Ruby
def create
    if search_params[:ladies].blank? && search_params[:mens].blank?
      # ã‚‚ã—ã€æ€§åˆ¥æ¬„ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒç”·å¥³ã¨ã‚‚ã«ãƒã‚§ãƒƒã‚¯ãŒå¤–ã•ã‚Œã¦ã„ãŸå ´åˆã¯ã€æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã«æˆ»ã™ã€‚
      redirect_to staff_searches_path
    elsif search_params[:ladies] == 'true' && search_params[:mens] == 'true'
      @osyalista = Osyalista.readonly.order(gender: :DESC, height: :ASC).includes(gu_store: :prefecture)
        # å–å¾—ã—ãŸæ¤œç´¢çµæœã‹ã‚‰ä¸Šæ›¸ãä¿å­˜ã•ã›ã‚‹ã“ã¨ã¯ãªã„ã®ã§ã€.readonlyï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰ã¨ã—ã¦èª­ã¿è¾¼ã‚€ã€‚
        # ãŠã—ã‚ƒãƒªã‚¹ã‚¿ã®æƒ…å ±ã‹ã‚‰ã€æ‰€å±åº—èˆ—ã‚‚èª­ã¿è¾¼ã‚€å¿…è¦ãŒã‚ã‚‹ãŸã‚ã«ã€.includes ã§ N+1 ã«ãªã‚‹ã“ã¨ã‚’é¿ã‘ã‚‹ã€‚
    elsif search_params[:ladies] == 'true'
      @osyalista = Osyalista.readonly.where(gender: true).order(height: :ASC).includes(gu_store: :prefecture)
    elsif search_params[:mens] == 'true'
      @osyalista = Osyalista.readonly.where(gender: false).order(height: :ASC).includes(gu_store: :prefecture)
    end

    unless search_params[:store].blank?
      # ã‚‚ã—ã€æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã§åº—èˆ—ã‚’æŒ‡å®šã—ã¦ã„ãŸå ´åˆã¯ã€æ¬¡ã®å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
      @osyalista = @osyalista.select { |osyalista| osyalista.store_id == search_params[:store].to_i }
        # äº‹å‰ã«ã€å–å¾—ã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã®é…åˆ—ã®ä¸­ã® 'store_id' ã‚«ãƒ©ãƒ ãŒãƒ•ã‚©ãƒ¼ãƒ ã§æŒ‡å®šã—ãŸåº—èˆ—ã¨åŒã˜ã‚‚ã®ã‚’æŠ½å‡ºã™ã‚‹ã€‚
    end

    render action: :index, osyalista: @osyalista
  end

  private
  def search_params
    params.permit(:ladies, :mens, :store)
      # å—ä¿¡ã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰å¿…è¦ãªé …ç›®ã®ã¿å–å¾—ã™ã‚‹ã€‚
  end
```

---

## ğŸ”œã€€â‘¦ ã“ã‚Œã‹ã‚‰ã€å®Ÿè£…äºˆå®šã®æ©Ÿèƒ½

1. æœŸé™ä»˜ã Cookie ã‚’ä½¿ç”¨ã—ãŸæ°—ã«ãªã‚‹ãŠã—ã‚ƒãƒªã‚¹ã‚¿ã®ä¸€æ™‚ä¿å­˜æ©Ÿèƒ½  
â— èª°ã§ã‚‚æ°—è»½ã«åˆ©ç”¨ã—ã¦ã‚‚ã‚‰ã„ãŸã„ãŸã‚ã€ã§ãã‚‹é™ã‚Š èªè¨¼æ©Ÿèƒ½ã¯ä½¿ã‚ãšã«ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚

2. Instagram ã‚°ãƒ©ãƒ• API ã‚’ä½¿ç”¨ã—ã€GUå…¬èªã‚¹ã‚¿ãƒƒãƒ•ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æƒ…å ±å–å¾—  

- GUå…¬èªã‚¹ã‚¿ãƒƒãƒ•ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ å‚™å¿˜éŒ²
  - [Moena | ãƒ‘ãƒ¯ãƒ¼ãƒ¢ãƒ¼ãƒ«å‰æ©‹ã¿ãªã¿åº—](https://www.gu-global.com/jp/ja/styling/staff/31f2bd7bd00f450491b9e9ea309a185c)
  - [Haru | éƒ¡å±±å…«å±±ç”°åº—](https://www.gu-global.com/jp/ja/styling/staff/b3cfe95deda8a8733e81a698634ed0d3)
  - [Rikako | éŠ€åº§åº—](https://www.gu-global.com/jp/ja/styling/staff/cfa973461ff2efe679613a4296f8d492)
  - [mika | æ±é‡‘åº—](https://www.gu-global.com/jp/ja/styling/staff/594d39914b575d9b8d699b0f17992797)
  - [kozue | å¯Œå£«åº—](https://www.gu-global.com/jp/ja/styling/staff/a3852599700d6ddce64d8a845ee8e729) 
  - [Ryoko | å¿ƒæ–æ©‹åº—](https://www.gu-global.com/jp/ja/styling/staff/110d0136606abcd2fe3ed270ef3802f8)
  - [aki | ã‚¤ã‚ªãƒ³ãƒ¢ãƒ¼ãƒ«å ºåŒ—èŠ±ç”°åº—](https://www.gu-global.com/jp/ja/styling/staff/3ad9bbef4e203cca178dcc73740247eb)
  - [yuko | è¥¿å®®æµœåº—](https://www.gu-global.com/jp/ja/styling/staff/2634826eb62569f8b708a9244d140e76)
  - [Kai | ã‚¤ã‚ªãƒ³ãƒ¢ãƒ¼ãƒ«æ–°å±…æµœåº—](https://www.gu-global.com/jp/ja/styling/staff/e166b68d21bdcc8a96ea9d57abe07bc0)
  - [Satomi | ãƒ¨ãƒ‰ãƒã‚·åšå¤šåº—](https://www.gu-global.com/jp/ja/styling/staff/ce22f6d46f1dad725beece0b2e0bea64)

---

## ğŸ‘¨ğŸ»â€ğŸ’» â‘§ é–‹ç™ºè€…ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«

- Wantedlyï¼š[Wantedly](https://www.wantedly.com/id/Hirano_Tech)ï¼ˆè¦ ãƒ­ã‚°ã‚¤ãƒ³ï¼‰
- GitHubï¼š[GitHub](https://github.com/Hirano-Tech)
  - [ç¾åœ¨ å€‹äººé–‹ç™ºã—ã¦ã„ã‚‹åˆ¥ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ | GitHub](https://github.com/Hirano-Tech/Piston2438_DJ-MIX)
- Twitterï¼š[@Hirano_Tech](https://twitter.com/Hirano_Tech)
- Zennï¼š[Zenn](https://zenn.dev/hirano_tech)
